<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Tailwind CSS -->
    <link
      rel="shortcut icon"
      href="https://raw.githubusercontent.com/JeanCardozo/audios/main/z.png"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.16/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="../../../src/output.css" />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />

    <title>Crear plan de entrenamiento</title>
  </head>
  <body class="bg-fondo">
    <%- include('../plantillas/navbar.ejs') %>
    <a
      href="/ver_plan_ent"
      class="inline-flex items-center justify-center py-4 px-6 text-white font-semibold rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition-colors duration-200"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 19l-7-7 7-7"
        />
      </svg>
    </a>

    <div class="flex justify-center items-center">
      <div class="w-full max-w-3xl mx-auto p-8 bg-gray-50 rounded-lg shadow-md">
        <div class="mb-8">
          <h2 class="text-center p-4 text-2xl font-semibold text-gray-800">
            Planificador de Entrenamiento
          </h2>
        </div>
        <form id="entrenamientoForm" class="space-y-6">
          <div>
            <label
              for="day"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Día de entrenamiento</label
            >
            <select
              id="day"
              name="day"
              onchange="mostrarTipoEntrenamiento()"
              class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent"
            >
              <option value="">Selecciona un día</option>
              <option value="Lunes">Lunes</option>
              <option value="Martes">Martes</option>
              <option value="Miercoles">Miércoles</option>
              <option value="Jueves">Jueves</option>
              <option value="Viernes">Viernes</option>
              <option value="Sabado">Sábado</option>
            </select>
          </div>
          <div>
            <label
              for="id_cliente"
              class="block text-sm font-medium text-gray-700 mb-1"
              >ID Cliente</label
            >
            <input
              type="number"
              id="id_cliente"
              name="id_cliente"
              required
              class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent"
            />
          </div>

          <div id="tipoEntrenamiento" class="hidden">
            <fieldset>
              <legend class="text-sm font-medium text-gray-700 mb-2">
                Tipo de entrenamiento
              </legend>
              <div class="space-y-2">
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="superior"
                    name="type"
                    value="superior"
                    onchange="mostrarMusculos()"
                    class="h-5 w-5 text-gray-600 focus:ring-gray-500 border-gray-300 rounded"
                  />
                  <label for="superior" class="ml-3 text-sm text-gray-700"
                    >Tren superior</label
                  >
                </div>
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="inferior"
                    name="type"
                    value="inferior"
                    onchange="mostrarMusculos()"
                    class="h-5 w-5 text-gray-600 focus:ring-gray-500 border-gray-300 rounded"
                  />
                  <label for="inferior" class="ml-3 text-sm text-gray-700"
                    >Tren inferior</label
                  >
                </div>
              </div>
            </fieldset>
          </div>

          <div id="musculos" class="hidden">
            <fieldset>
              <legend class="text-sm font-medium text-gray-700 mb-2">
                Grupos musculares
              </legend>
              <div id="muscleList" class="grid grid-cols-2 gap-3">
                <% gruposMusculares.forEach(grupo => { %>
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="<%= grupo.id %>"
                    value="<%= grupo.nombre %>"
                    name="muscles"
                    onchange="mostrarEjercicios()"
                    class="h-5 w-5 text-gray-600 focus:ring-gray-500 border-gray-300 rounded"
                  />
                  <label
                    for="<%= grupo.id %>"
                    class="ml-3 text-sm text-gray-700"
                    ><%= grupo.nombre %></label
                  >
                </div>
                <% }) %>
              </div>
            </fieldset>
          </div>

          <div id="ejercicios" class="hidden">
            <fieldset>
              <legend class="text-sm font-medium text-gray-700 mb-2">
                Ejercicios
              </legend>
              <div id="exerciseList" class="space-y-3">
                <% actividades.forEach(actividad => { %>
                <div
                  class="exercise-group hidden"
                  data-muscle="<%= actividad.gm_nombre %>"
                >
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="<%= actividad.af_id %>"
                      value="<%= actividad.af_nombre %>"
                      name="exercises"
                      onchange="mostrarSeriesReps()"
                      class="h-5 w-5 text-gray-600 focus:ring-gray-500 border-gray-300 rounded"
                    />
                    <label
                      for="<%= actividad.af_id %>"
                      class="ml-3 text-sm text-gray-700"
                      ><%= actividad.af_nombre %></label
                    >
                  </div>
                </div>
                <% }) %>
              </div>
            </fieldset>
          </div>

          <div id="seriesReps" class="hidden space-y-5">
            <!-- Se llenará dinámicamente con detalles para cada ejercicio seleccionado -->
          </div>

          <button
            type="button"
            onclick="guardarRutina()"
            class="w-full py-3 px-4 bg-gray-800 text-white text-lg font-medium rounded-md shadow-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition duration-300"
          >
            Guardar Rutina
          </button>
        </form>
      </div>
    </div>

    <script>






                                       // Datos provenientes del servidor
                                       const gruposMusculares = <%- JSON.stringify(gruposMusculares) %>;
                                       const actividades = <%- JSON.stringify(actividades) %>;
                                       function mostrarTipoEntrenamiento() {
                                         const day = document.getElementById("day").value;
                                         if (day) {
                                           document.getElementById("tipoEntrenamiento").classList.remove("hidden");
                                         } else {
                                           document.getElementById("tipoEntrenamiento").classList.add("hidden");
                                           document.getElementById("musculos").classList.add("hidden");
                                           document.getElementById("ejercicios").classList.add("hidden");
                                           document.getElementById("seriesReps").classList.add("hidden");
                                         }
                                       }
                                       function mostrarMusculos() {
                                         const types = Array.from(
                                           document.querySelectorAll('input[name="type"]:checked')
                                         ).map((checkbox) => checkbox.value);
                                         const muscleList = document.getElementById("muscleList");
                                         muscleList.innerHTML = ""; // Limpia los músculos previos
                                         let muscles = [];
                                         if (types.includes("superior")) {
                                           muscles = [
                                             ...muscles,
                                             ...gruposMusculares.filter(gm => gm.seccion === "Tren Superior")
                                           ];
                                         }
                                         if (types.includes("inferior")) {
                                           muscles = [
                                             ...muscles,
                                             ...gruposMusculares.filter(gm => gm.seccion === "Tren Inferior")
                                           ];
                                         }
                                         muscles.forEach((muscle) => {
                                           const checkbox = document.createElement("input");
                                           checkbox.type = "checkbox";
                                           checkbox.id = muscle.id;
                                           checkbox.value = muscle.nombre;
                                           checkbox.name = "muscles";
                                           checkbox.onchange = mostrarEjercicios;
                                           const label = document.createElement("label");
                                           label.htmlFor = muscle.id;
                                           label.textContent = muscle.nombre;
                                           const div = document.createElement("div");
                                           div.classList.add("muscle-group");
                                           div.appendChild(checkbox);
                                           div.appendChild(label);
                                           muscleList.appendChild(div);
                                         });
                                         if (muscles.length > 0) {
                                           document.getElementById("musculos").classList.remove("hidden");
                                         } else {
                                           document.getElementById("musculos").classList.add("hidden");
                                           document.getElementById("ejercicios").classList.add("hidden");
                                           document.getElementById("seriesReps").classList.add("hidden");
                                         }
                                       }
                                       function mostrarEjercicios() {
                                         const selectedMuscles = Array.from(
                                           document.querySelectorAll('input[name="muscles"]:checked')
                                         ).map((checkbox) => checkbox.value);
                                         const exerciseList = document.getElementById("exerciseList");
                                         exerciseList.innerHTML = ""; // Limpia los ejercicios previos
                                         let hasExercises = false;
                                         selectedMuscles.forEach((muscle) => {
                                           const muscleDiv = document.createElement("div");
                                           muscleDiv.classList.add("muscle-group");
                                           const muscleLabel = document.createElement("h4");
                                           muscleLabel.textContent = `Ejercicios para ${muscle}`;
                                           muscleDiv.appendChild(muscleLabel);
                                           const muscleActivities = actividades.filter(
                                             (actividad) => actividad.gm_nombre === muscle
                                           );
                                           muscleActivities.forEach((actividad) => {
                                             const checkbox = document.createElement("input");
                                             checkbox.type = "checkbox";
                                             checkbox.id = actividad.af_id;
                                             checkbox.value = actividad.af_nombre;
                                             checkbox.name = "exercises";
                                             checkbox.onchange = mostrarSeriesReps;
                                             const label = document.createElement("label");
                                             label.htmlFor = actividad.af_id;
                                             label.textContent = actividad.af_nombre;
                                             const div = document.createElement("div");
                                             div.classList.add("exercise-group");
                                             div.appendChild(checkbox);
                                             div.appendChild(label);
                                             muscleDiv.appendChild(div);
                                           });
                                           exerciseList.appendChild(muscleDiv);
                                           hasExercises = true;
                                         });
                                         if (hasExercises) {
                                           document.getElementById("ejercicios").classList.remove("hidden");
                                         } else {
                                           document.getElementById("ejercicios").classList.add("hidden");
                                           document.getElementById("seriesReps").classList.add("hidden");
                                         }
                                       }
                                       function mostrarSeriesReps() {
                                         const selectedExercises = Array.from(
                                           document.querySelectorAll('input[name="exercises"]:checked')
                                         ).map((checkbox) => checkbox.value);
                                         const seriesReps = document.getElementById("seriesReps");
                                         seriesReps.innerHTML = ""; // Limpia las series y repeticiones previas
                                         selectedExercises.forEach((exercise) => {
                                           const exerciseDiv = document.createElement("div");
                                           exerciseDiv.classList.add("exercise-details");
                                           const exerciseLabel = document.createElement("label");
                                           exerciseLabel.textContent = `Series y repeticiones para ${exercise.replace(/_/g, " ").toUpperCase()}:`;
                                           exerciseDiv.appendChild(exerciseLabel);
                                           const seriesInput = document.createElement("input");
                                           seriesInput.type = "number";
                                           seriesInput.id = `${exercise}_series`;
                                           seriesInput.placeholder = "Series";
                                           seriesInput.min = "1";
                                           seriesInput.name = `${exercise}_series`;
                                           const repsInput = document.createElement("input");
                                           repsInput.type = "number";
                                           repsInput.id = `${exercise}_reps`;
                                           repsInput.placeholder = "Repeticiones";
                                           repsInput.min = "1";
                                           repsInput.name = `${exercise}_reps`;
                                           const div = document.createElement("div");
                                           div.appendChild(seriesInput);
                                           div.appendChild(repsInput);
                                           exerciseDiv.appendChild(div);
                                           seriesReps.appendChild(exerciseDiv);
                                         });
                                         if (selectedExercises.length > 0) {
                                           document.getElementById("seriesReps").classList.remove("hidden");
                                         } else {
                                           document.getElementById("seriesReps").classList.add("hidden");
                                         }
                                       }

                                        function guardarRutina() {
          const id_cliente = parseInt(document.getElementById("id_cliente").value, 10) || 0;
          const dia = document.getElementById("day").value;

          const tipo_tren = Array.from(document.querySelectorAll('input[name="type"]:checked'))
              .map(cb => cb.value);

          const musculo = Array.from(document.querySelectorAll('input[name="muscles"]:checked'))
              .map(cb => cb.value);

          const ejercicio = Array.from(document.querySelectorAll('input[name="exercises"]:checked'))
              .map(cb => cb.value);

          let series = [];
          let repeticiones = [];

          document.querySelectorAll('.exercise-details').forEach(detail => {
              const seriesInput = detail.querySelector('input[name$="_series"]');
              const repsInput = detail.querySelector('input[name$="_reps"]');

              if (seriesInput && repsInput) {
                  series.push(parseInt(seriesInput.value, 10) || 0);
                  repeticiones.push(parseInt(repsInput.value, 10) || 0);
              }
          });

          const data = {
              id_cliente,
              dia,
              tipo_tren,
              musculo,
              ejercicio,
              series,
              repeticiones
          };

          // const datos = {
          // id_cliente,
          // dia,
          // data:
          //    { tren: [
            // {
            //   tipo_tren: "superior",
            //   musculos: [
            //     {
            //       nombre_musculo: "Hombro",
            //       ejercicios: [
            //         {
            //           nombre: "Press militar",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //         {
            //           nombre: "Press Banca",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //         {
            //           nombre: "Manca",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //       ]
            //     },
            //     {
            //       nombre: "Nalga Derecha",
            //       ejercicios: [
            //         {
            //           nombre: "Culo",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //       ]
            //     },
            //     {
            //       nombre: "Piernas",
            //       ejercicios: [
            //         {
            //           nombre: "Prensa",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //         {
            //           nombre: "Press Pussio",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //         {
            //           nombre: "We",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //       ]
            //     }
            //   ]
            //   },
            //     {
            //     tipo_tren: "inferior",
            //     musculos: [
            //     {
            //       nombre_musculo: "Hombro",
            //       ejercicios: [
            //         {
            //           nombre: "Press militar",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //         {
            //           nombre: "Press Banca",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //         {
            //           nombre: "Manca",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //       ]
            //     },
            //     {
            //       nombre: "Nalga Derecha",
            //       ejercicios: [
            //         {
            //           nombre: "Culo",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //       ]
            //     },
            //     {
            //       nombre: "Piernas",
            //       ejercicios: [
            //         {
            //           nombre: "Prensa",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //         {
            //           nombre: "Press Pussio",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //         {
            //           nombre: "We",
            //           series: 22,
            //           repeticiones: 22,
            //         },
            //       ]
            //     }
            //   ]
            //   }
            // ]

          // }






          console.log('Datos enviados:', data);

          fetch('/entrenamiento/guardar', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
          })
          .then(response => response.text())
          .then(result => {
              console.log('Respuesta del servidor:', result);
              alert(result);
          })
          .catch(error => {
              console.error('Error:', error);
              alert('Error al guardar la rutina');
          });
      }
    </script>
  </body>
</html>
